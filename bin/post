#!/bin/sh

# BLOG_DIR needs to be set in your zsh shell
POST_DATE=$(date)

# /content/blog
# /content/log

# This script is used to create a Hugo post (specifically for Henry)
TYPE=$(gum choose "post" "log")

if [ "$TYPE" == "log" ]; then
    echo "You chose to write the monthly log"

    echo "xxx debugging - date is now $POST_DATE"
    FILE="$BLOG_DIR/content/log/$(gdate -d "$POST_DATE" +%Y-%m).md"

    if [ -f "$FILE" ];
    then
        POST_DATE=$(date +%Y-%m-01)
        echo "log file for this month already present"
        gum confirm "Do you want to create it for the next month?" && POST_DATE=$(gdate -d "$POST_DATE +1 month +1 day") || exit 0
    fi

        echo "xxx debugging - date is now $POST_DATE"
        FILE="$BLOG_DIR/content/log/$(gdate -d "$POST_DATE" +%Y-%m).md"

        touch $FILE
        echo "creating log file"
        echo "---
draft: true
date: $(gdate -d "$POST_DATE" +%Y-%m-01T%H:%M:%S%z)
summary: Log for things done in $(gdate -d "$POST_DATE" +%B)
---

# Excerpts


# Review $(gdate -d "$POST_DATE" +%B)'s Goals
-

# Goals for $(gdate -d "$POST_DATE +1 month" +%B)
-

" >> $FILE
    exit 0
fi

# date +%F
# 2022-08-20

TITLE=$(gum input --placeholder "Enter Title of the post")

SLUG=$(gum input --placeholder "Enter Slug (Enter to skip)")
if [ -n "$SLUG" ]; then
    SLUG=$(echo "$SLUG" | tr " " "-" | awk '{print tolower($0)}')
else
    SLUG=$(echo "$TITLE" | tr " " "-" | awk '{print tolower($0)}')
fi

POST_DIR=$(echo "$BLOG_DIR/content/blog/$(date +%F)-$SLUG")

echo "creating directory - $POST_DIR"
mkdir -p $POST_DIR

FILE="$POST_DIR/index.md"
touch $FILE

echo "---
draft: true
date: $(date +%Y-%m-%dT%H:%M:%S%z)
title: $TITLE
slug: $SLUG
summary: Mini desc. used in twitter & SEO
banner: /images/content/tw-xxx.png
tags: [tag]
categories: [category]
externalLink: https://daring-fireball-style
aliases: [/2010/new-year/]
canonicalUrl: https://when-posted-first-on-medium
---" >> $FILE